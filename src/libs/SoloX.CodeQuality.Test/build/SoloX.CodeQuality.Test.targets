<Project>

  <UsingTask
      TaskName="CopyTextFile"
      TaskFactory="RoslynCodeTaskFactory"
      AssemblyFile="$(MSBuildToolsPath)\Microsoft.Build.Tasks.Core.dll">
    <ParameterGroup>
      <InputFilename ParameterType="System.String" Required="true" />
      <OutputFilename ParameterType="System.String" Required="true" />
      <Overwrite ParameterType="System.Boolean" Required="true" />
    </ParameterGroup>
    <Task>
      <Using Namespace="System.IO"/>
      <Code Type="Fragment" Language="cs">
        <![CDATA[  
            if (Overwrite)
            {
                File.WriteAllText(OutputFilename, File.ReadAllText(InputFilename));
            }
            else
            {
                File.AppendAllText(OutputFilename, File.ReadAllText(InputFilename));
            }
        ]]>
      </Code>
    </Task>
  </UsingTask>

  <Target Condition="$(CodeQualityOverrideEditorConfig) == true"
          Name="CodeQualityMain"
          BeforeTargets="BeforeBuild;BeforeRebuild;AfterResolveReferences">

    <ItemGroup>
      <OutputEditorConfigFile Include="$(MSBuildProjectDirectory)/.editorconfig" />
      <CsCaEditorConfigFile Include="$(MSBuildThisFileDirectory)../resources/style.cs.compiler.ca.editorconfig" />
      <CsCsEditorConfigFile Include="$(MSBuildThisFileDirectory)../resources/style.cs.compiler.cs.editorconfig" />
      <Ide1EditorConfigFile Include="$(MSBuildThisFileDirectory)../resources/style.cs.ide1.editorconfig" />
      <Ide2EditorConfigFile Include="$(MSBuildThisFileDirectory)../resources/style.cs.ide2.editorconfig" />
      <GenEditorConfigFile Include="$(MSBuildThisFileDirectory)../resources/style.generated.editorconfig" />
      <RazorEditorConfigFile Include="$(MSBuildThisFileDirectory)../resources/style.razor.editorconfig" />
      <WebEditorConfigFile Include="$(MSBuildThisFileDirectory)../resources/style.web.editorconfig" />
    </ItemGroup>

    <CopyTextFile
      InputFilename="@(WebEditorConfigFile)" OutputFilename="@(OutputEditorConfigFile)" Overwrite="true" />
    <CopyTextFile
      InputFilename="@(RazorEditorConfigFile)" OutputFilename="@(OutputEditorConfigFile)" Overwrite="false" />
    <CopyTextFile
      InputFilename="@(GenEditorConfigFile)" OutputFilename="@(OutputEditorConfigFile)" Overwrite="false" />
    <CopyTextFile
      Condition="$(CodeQualityFieldsUseUnderscorStyle) == false"
      InputFilename="@(Ide1EditorConfigFile)" OutputFilename="@(OutputEditorConfigFile)" Overwrite="false" />
    <CopyTextFile
      Condition="$(CodeQualityFieldsUseUnderscorStyle) == true"
      InputFilename="@(Ide2EditorConfigFile)" OutputFilename="@(OutputEditorConfigFile)" Overwrite="false" />
    <CopyTextFile
      InputFilename="@(CsCsEditorConfigFile)" OutputFilename="@(OutputEditorConfigFile)" Overwrite="false" />
    <CopyTextFile
      InputFilename="@(CsCaEditorConfigFile)" OutputFilename="@(OutputEditorConfigFile)" Overwrite="false" />

  </Target>

</Project>